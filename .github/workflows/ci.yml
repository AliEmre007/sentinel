name: Sentinel CI Pipeline

# ==========================================
# 1. THE TRIGGERS (When does this run?)
# ==========================================
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# ==========================================
# 2. THE JOBS (What does the robot do?)
# ==========================================
jobs:
  build-and-test:
    name: Run Tests and Verify Build
    # BEST PRACTICE: Always use the latest Ubuntu LTS for standard cloud pipelines
    runs-on: ubuntu-latest

    steps:
    # Step A: Checkout the code from your repository
    - name: Checkout Source Code
      uses: actions/checkout@v4

    # Step B: Install the exact Go version we used in development
    - name: Set up Go 1.24
      uses: actions/setup-go@v5
      with:
        go-version: '1.24.x'
        # BEST PRACTICE: Enable caching so dependencies don't download every time
        cache: true 

    # Step C: Download the Go modules
    - name: Install Dependencies
      run: go mod download

    # Step D: Run the microsecond test suite we wrote earlier
    - name: Execute Unit and Integration Tests
      run: go test -v ./...

    # Step E: Prove that the code can compile into a production binary
    - name: Verify Production Build
      env:
        CGO_ENABLED: 0
        GOOS: linux
      run: go build -ldflags="-w -s" -o sentinel-binary .
